<div class="reservations-container">
  <div *ngIf="showNotification" class="notification-toast" [class]="notificationType" [@slideInDown]>
    <div class="notification-content">
      <i [class]="notificationIcon"></i>
      <span>{{notificationMessage}}</span>
    </div>
    <button class="close-notification" (click)="hideNotification()">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <!-- Customer Reservation View -->
  <div *ngIf="customerReservation" class="reservation-card" [@fadeInUp]>
    <div class="reservation-header">
      <h2>Your Reservation</h2>
      <div class="header-divider"></div>
    </div>

    <div class="reservation-details">
      <div class="detail-item">
        <div class="detail-icon">
          <i class="fas fa-user"></i>
        </div>
        <div class="detail-content">
          <span class="detail-label">Customer Name</span>
          <span class="detail-value">{{myReservation.customerFirstName +' '+ myReservation.customerLastName}}</span>
        </div>
      </div>

    <div class="reservation-details">
      <div class="detail-item">
        <div class="detail-icon">
          <i class="fas fa-calendar-days"></i>
        </div>
        <div class="detail-content">
          <span class="detail-label">Reservation Date</span>
          <span class="detail-value">{{myReservation.reservationDate | date:'fullDate'}}</span>
        </div>
      </div>

      <div class="detail-item">
        <div class="detail-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="detail-content">
          <span class="detail-label">Reservation Time</span>
          <span class="detail-value">{{myReservation.reservationTime}}</span>
        </div>
      </div>

      <div class="detail-item">
        <div class="detail-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="detail-content">
          <span class="detail-label">Number of People</span>
          <span class="detail-value">{{myReservation.numberOfPeople}} {{(myReservation.numberOfPeople || 0) > 1 ? 'people' : 'person'}}</span>
        </div>
      </div>

      <div *ngIf="myReservation.specialRequests" class="detail-item">
        <div class="detail-icon">
          <i class="fas fa-pen-to-square"></i>
        </div>
        <div class="detail-content">
          <span class="detail-label">Special Requests</span>
          <div class="special-requests">
            <p [class.expanded]="show">{{show ? myReservation.specialRequests : (myReservation.specialRequests | slice:0:100)}}</p>
            <button *ngIf="myReservation.specialRequests.length > 100"
                    class="read-more-btn"
                    (click)="show = !show">
              {{show ? 'Read less' : 'Read more'}}
            </button>
          </div>
        </div>
      </div>
    </div>

      <div class="detail-item">
        <div class="detail-icon">
          <i [ngClass]="getStatusIcon(myReservation.status)"></i>
        </div>
        <div class="detail-content">
          <span class="detail-label">Status</span>
          <span class="detail-value status-badge" [ngClass]="getStatus(myReservation.status)">
            {{myReservation.status}}
          </span>
        </div>
      </div>
    </div>

    <div class="reservation-actions">
      <button class="btn btn-update" (click)="openReservationForm()">
        <i class="fas fa-edit"></i>
        Update Reservation
      </button>
      <button class="btn btn-cancel" (click)="showConfirm=true"
              [disabled]="myReservation.status === 'Cancelled'">
        <i class="fas fa-times"></i>
        {{myReservation.status === 'Cancelled' ? 'Already Cancelled' : 'Cancel Reservation'}}
      </button>
    </div>
  </div>

  <!-- Admin Reservations View -->
  <div *ngIf="adminReservations" class="admin-reservations" [@fadeIn]>
    <div class="admin-header">
      <h2>Reservation Management</h2>
      <button class="btn btn-primary" (click)="openReservationForm()">
        <i class="fas fa-plus"></i>
        Make A Reservation
      </button>
    </div>

    <div class="reservations-table-container">
      <table class="reservations-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Customer Name</th>
            <th>Created</th>
            <th>Reservation Date</th>
            <th>Time</th>
            <th>People</th>
            <th>Status</th>
            <th>Special Requests</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reservation of Reservations" [@slideIn]>
            <td>{{reservation.reservationId}}</td>
            <td>{{reservation.customerFirstName+' '+reservation.customerLastName}}</td>
            <td>{{reservation.creationDate | date:'short'}}</td>
            <td>{{reservation.reservationDate | date:'mediumDate'}}</td>
            <td>{{reservation.reservationTime}}</td>
            <td>{{reservation.numberOfPeople}}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatus(reservation.status)">
                {{reservation.status}}
              </span>
            </td>
            <td class="requests-cell">
              {{reservation.specialRequests || 'No special requests'}}
            </td>
            <td class="actions-cell">
              <button class="btn btn-sm btn-update" (click)="PrepareReservation(reservation); openReservationForm()">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-cancel"
                      (click)="PrepareReservation(reservation)"
                      (click)="showConfirm=true"
                      [disabled]="reservation.status === 'Cancelled'">
                <i class="fas fa-times"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Reservation Form -->
  <div *ngIf="ReservationForm" class="reservation-form-overlay" [@fadeIn]>
    <div class="reservation-form-container" [@slideInUp]>
      <div class="form-header">
        <h3>{{ReservationExist ? 'Update Reservation' : 'Create Reservation'}}</h3>
        <button class="close-btn" (click)="closeReservationForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [ngClass]="{'admin-form':role==='Admin'}" class="reservation-form" (ngSubmit)="ReservationExist ? UpdateReservation() : CreateReservation()">
        <div *ngIf="this.role==='Admin'">
          <div class="form-group">
            <label for="name">
              <i class="fas fa-user"></i>
              Customer First Name
            </label>
            <input  type="text" id="name" [(ngModel)]="myReservation.customerFirstName"
                  [ngModelOptions]="{standalone: true}"
                  required>
          </div>
          <div class="form-group">
            <label for="name">
              <i class="fas fa-user"></i>
              Customer Last Name
            </label>
            <input  type="text" id="name" [(ngModel)]="myReservation.customerLastName"
                  [ngModelOptions]="{standalone: true}"
                  required>
          </div>
        </div>

        <div class="form-group">
          <label for="date">
            <i class="fas fa-calendar"></i>
            Reservation Date *
          </label>
          <input  type="date" id="date" [(ngModel)]="myReservation.reservationDate"
                 [ngModelOptions]="{standalone: true}"
                 [min]="minDate"
                 required>
          <div *ngIf="!myReservation.reservationDate" class="error-message">
            Please select a reservation date
          </div>
        </div>

        <div class="form-group">
          <label for="time">
            <i class="fas fa-clock"></i>
            Reservation Time *
          </label>
          <select id="time" [(ngModel)]="myReservation.reservationTime"
                  [ngModelOptions]="{standalone: true}" required>
            <option value="" disabled selected>Select a time</option>
            <option *ngFor="let time of availableTimes" [value]="time">
              {{time+' PM'}}
            </option>
          </select>
          <div *ngIf="!myReservation.reservationTime" class="error-message">
            Please select a reservation time
          </div>
        </div>

        <div class="form-group">
          <label for="people">
            <i class="fas fa-users"></i>
            Number of People *
          </label>
          <input type="number" id="people" [(ngModel)]="myReservation.numberOfPeople"
                 [ngModelOptions]="{standalone: true}"
                 min="1" max="20" required>
          <div *ngIf="!myReservation.numberOfPeople" class="error-message">
            Please enter number of people
          </div>
        </div>

        <div class="form-group">
          <label for="requests">
            <i class="fas fa-pen-to-square"></i>
            Special Requests
          </label>
          <textarea id="requests" [(ngModel)]="myReservation.specialRequests"
                    [ngModelOptions]="{standalone: true}"
                    rows="3" placeholder="Any special requests or notes..."></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeReservationForm()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            {{ReservationExist ? 'Update Reservation' : 'Create Reservation'}}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- No Reservation for Customer -->
  <div *ngIf="showNoReservation"
       class="no-reservation" [@fadeIn]>
    <div class="no-reservation-content">
      <i class="fas fa-calendar-plus"></i>
      <h2>No Reservation Found</h2>
      <p>There is no any active reservations. Would you like to make one?</p>
      <button class="btn btn-primary" (click)="openReservationForm()">
        <i class="fas fa-plus"></i>
        Create Reservation
      </button>
    </div>
  </div>
  <div *ngIf="isLoading" class="loading-state" [@fadeIn]>
    <div class="loading-spinner"></div>
    <p>Loading reservations...</p>
  </div>
  <app-confirm-dialog
    *ngIf="showConfirm"
    message="Are you sure you want to cancel this Reservation?"
    (confirmed)="onConfirm($event)">
  </app-confirm-dialog>
</div>
